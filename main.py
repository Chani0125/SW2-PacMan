from PyQt5.QtCore import *
from PyQt5.QtWidgets import *
from PyQt5.QtGui import *

from player import PacMan
from enemy import Ghost


class PacManGame(QWidget):
    # 0: 벽, 1: 빈 곳, 2: 쿠키, 3: 파워 쿠키
    map_obj_info = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
        [0, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 0],
        [0, 3, 0, 0, 2, 0, 0, 0, 2, 0, 2, 0, 0, 0, 2, 0, 0, 3, 0],
        [0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0],
        [0, 2, 0, 0, 2, 0, 2, 0, 0, 0, 0, 0, 2, 0, 2, 0, 0, 2, 0],
        [0, 2, 2, 2, 2, 0, 2, 2, 2, 0, 2, 2, 2, 0, 2, 2, 2, 2, 0],
        [0, 0, 0, 0, 2, 0, 0, 0, 1, 0, 1, 0, 0, 0, 2, 0, 0, 0, 0],
        [1, 1, 1, 0, 2, 0, 1, 1, 1, 1, 1, 1, 1, 0, 2, 0, 1, 1, 1],
        [0, 0, 0, 0, 2, 0, 1, 0, 0, 0, 0, 0, 1, 0, 2, 0, 0, 0, 0],
        [1, 1, 1, 1, 2, 1, 1, 0, 1, 1, 1, 0, 1, 1, 2, 1, 1, 1, 1],
        [0, 0, 0, 0, 2, 0, 1, 0, 0, 0, 0, 0, 1, 0, 2, 0, 0, 0, 0],
        [1, 1, 1, 0, 2, 0, 1, 1, 1, 1, 1, 1, 1, 0, 2, 0, 1, 1, 1],
        [0, 0, 0, 0, 2, 0, 1, 0, 0, 0, 0, 0, 1, 0, 2, 0, 0, 0, 0],
        [0, 2, 2, 2, 2, 2, 2, 2, 2, 0, 2, 2, 2, 2, 2, 2, 2, 2, 0],
        [0, 2, 0, 0, 2, 0, 0, 0, 2, 0, 2, 0, 0, 0, 2, 0, 0, 2, 0],
        [0, 3, 2, 0, 2, 2, 2, 2, 2, 1, 2, 2, 2, 2, 2, 0, 2, 3, 0],
        [0, 0, 2, 0, 2, 0, 2, 0, 0, 0, 0, 0, 2, 0, 2, 0, 2, 0, 0],
        [0, 2, 2, 2, 2, 0, 2, 2, 2, 0, 2, 2, 2, 0, 2, 2, 2, 2, 0],
        [0, 2, 0, 0, 0, 0, 0, 0, 2, 0, 2, 0, 0, 0, 0, 0, 0, 2, 0],
        [0, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 0],
        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
    ]

    map_img_info = [
        [("3", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("4", 1), ("2", 0),
         ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("3", 1)],
        [("2", 1), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("2", 1), ("0", 0), (
        "0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("2", 1)],
        [("2", 1), ("0", 0), ("1", 2), ("1", 0), ("0", 0), ("1", 2), ("2", 0), ("1", 0), ("0", 0), ("1", 1), ("0", 0), (
        "1", 2), ("2", 0), ("1", 0), ("0", 0), ("1", 2), ("1", 0), ("0", 0), ("2", 1)],
        [("2", 1), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), (
        "0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("2", 1)],
        [("2", 1), ("0", 0), ("1", 2), ("1", 0), ("0", 0), ("1", 3), ("0", 0), ("1", 2), ("2", 0), ("4", 1), ("2", 0), (
        "1", 0), ("0", 0), ("1", 3), ("0", 0), ("1", 2), ("1", 0), ("0", 0), ("2", 1)],
        [("2", 1), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("2", 1), ("0", 0), ("0", 0), ("0", 0), ("2", 1), ("0", 0), (
        "0", 0), ("0", 0), ("2", 1), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("2", 1)],
        [("3", 3), ("2", 0), ("2", 0), ("3", 1), ("0", 0), ("4", 0), ("2", 0), ("1", 0), ("0", 0), ("1", 1), ("0", 0), (
        "1", 2), ("2", 0), ("4", 2), ("0", 0), ("3", 0), ("2", 0), ("2", 0), ("3", 2)],
        [("0", 0), ("0", 0), ("0", 0), ("2", 1), ("0", 0), ("2", 1), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), (
        "0", 0), ("0", 0), ("2", 1), ("0", 0), ("2", 1), ("0", 0), ("0", 0), ("0", 0)],
        [("1", 2), ("2", 0), ("2", 0), ("3", 2), ("0", 0), ("1", 1), ("0", 0), ("8", 0), ("7", 0), ("6", 0), ("7", 2), (
        "8", 1), ("0", 0), ("1", 1), ("0", 0), ("3", 3), ("2", 0), ("2", 0), ("1", 0)],
        [("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("2", 1), ("0", 0), ("0", 0), ("0", 0), (
        "2", 1), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0)],
        [("1", 2), ("2", 0), ("2", 0), ("3", 1), ("0", 0), ("1", 3), ("0", 0), ("8", 3), ("2", 0), ("2", 0), ("2", 0), (
        "8", 2), ("0", 0), ("1", 3), ("0", 0), ("3", 0), ("2", 0), ("2", 0), ("1", 0)],
        [("0", 0), ("0", 0), ("0", 0), ("2", 1), ("0", 0), ("2", 1), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), (
        "0", 0), ("0", 0), ("2", 1), ("0", 0), ("2", 1), ("0", 0), ("0", 0), ("0", 0)],
        [("3", 0), ("2", 0), ("2", 0), ("3", 2), ("0", 0), ("1", 1), ("0", 0), ("1", 2), ("2", 0), ("4", 1), ("2", 0), (
        "1", 0), ("0", 0), ("1", 1), ("0", 0), ("3", 3), ("2", 0), ("2", 0), ("3", 1)],
        [("2", 1), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("2", 1), ("0", 0), (
        "0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("2", 1)],
        [("2", 1), ("0", 0), ("1", 2), ("3", 1), ("0", 0), ("1", 2), ("2", 0), ("1", 0), ("0", 0), ("1", 1), ("0", 0), (
        "1", 2), ("2", 0), ("1", 0), ("0", 0), ("3", 0), ("1", 0), ("0", 0), ("2", 1)],
        [("2", 1), ("0", 0), ("0", 0), ("2", 1), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), (
        "0", 0), ("0", 0), ("0", 0), ("0", 0), ("2", 1), ("0", 0), ("0", 0), ("2", 1)],
        [("4", 0), ("1", 0), ("0", 0), ("1", 1), ("0", 0), ("1", 3), ("0", 0), ("1", 2), ("2", 0), ("4", 1), ("2", 0), (
        "1", 0), ("0", 0), ("1", 3), ("0", 0), ("1", 1), ("0", 0), ("1", 2), ("4", 2)],
        [("2", 1), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("2", 1), ("0", 0), ("0", 0), ("0", 0), ("2", 1), ("0", 0), (
        "0", 0), ("0", 0), ("2", 1), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("2", 1)],
        [("2", 1), ("0", 0), ("1", 2), ("2", 0), ("2", 0), ("4", 3), ("2", 0), ("1", 0), ("0", 0), ("1", 1), ("0", 0), (
        "1", 2), ("2", 0), ("4", 3), ("2", 0), ("2", 0), ("1", 0), ("0", 0), ("2", 1)],
        [("2", 1), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), (
        "0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("0", 0), ("2", 1)],
        [("3", 3), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), (
        "2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("2", 0), ("3", 2)]
    ]

    DISPLAY_SIZE = 2

    def __init__(self):
        super().__init__()
        self.setMapImage()

        self.speed = 100  # 단위 속력 (ms)

        self.timer = QTimer(self)
        self.timer.start(self.speed)
        self.timer.timeout.connect(self.displaytMap)



    def setMapImage(self):
        self.map_img_layout = QGridLayout()
        self.map_img_label = [list() for _ in range(len(self.map_img_info))]
        self.map_img = [list() for _ in range(len(self.map_img_info))]
        for x in range(len(self.map_img_info)):
            for y in range(len(self.map_obj_info[x])):
                # Make Label For Image
                self.map_img_label[x].append(QLabel())
                self.map_img_label[x][y].resize(15 * self.DISPLAY_SIZE, 15 * self.DISPLAY_SIZE)
                # Load, Resize, and Rotate Image
                file = "images/Map" + self.map_img_info[x][y][0] + ".png"
                img = QPixmap(file).scaled(15 * self.DISPLAY_SIZE, 15 * self.DISPLAY_SIZE)
                img = img.transformed(QTransform().rotate(self.map_img_info[x][y][1] * 90))
                self.map_img[x].append(img)
                self.map_img_label[x][y].setPixmap(self.map_img[x][y])
                self.map_img_layout.addWidget(self.map_img_label[x][y], x, y)
        # Trim White Spaces
        self.map_img_layout.setContentsMargins(0, 0, 0, 0)
        self.map_img_layout.setSpacing(0)
        self.setLayout(self.map_img_layout)



    def displaytMap(self):
        for x in range(len(self.map_img_info)):
            for y in range(len(self.map_obj_info[x])):
                # Load, Resize, and Rotate Image
                file = "images/Map" + self.map_img_info[x][y][0] + ".png"
                img = QPixmap(file).scaled(15 * self.DISPLAY_SIZE, 15 * self.DISPLAY_SIZE)
                img = img.transformed(QTransform().rotate(self.map_img_info[x][y][1] * 90))
                self.map_img[x][y] = img
                self.map_img_label[x][y].setPixmap(self.map_img[x][y])


if __name__ == '__main__':
    import sys

    app = QApplication(sys.argv)
    game = PacManGame()
    for i in game.map_img_info:
        print("[", end="")
        for a, b in i:
            print("(\"" + str(a) + "\", " + str(b) + ")", end=", ")
        print("]", end="\n")
    print()
    game.show()
    sys.exit(app.exec_())
